library(data.table); library(ggplot2); library(qqman)
# Arguments
# args = commandArgs(trailingOnly=TRUE)
# i <- as.numeric(args[1]) # what pheno to look at?
i <- 69
# load data
workdir <- '/athena/elementolab/scratch/anm2868/GTEx/GTEx_infil/output/GeneticAnalysis/GWAS/'
f <- paste0(workdir,'GTEx.pheno',i,'.ALL_EBM.txt')
# load data
workdir <- '/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/'
f <- paste0(workdir,'output/GeneticAnalysis/GWAS/','GTEx.pheno',i,'.ALL_EBM.txt')
df <- fread(f,data.table = F,stringsAsFactors = F)
pvector <- df$Pval_Brown
n <- length(pvector)+1
exp.x <- -log10((rank(pvector, ties.method="first")-.5)/n)
pvalues <- -log10(pvector)
g <- ggplot(data.frame(exp=exp.x,obs=pvalues),aes(x=exp,y=obs)) + geom_point() + geom_abline(slope=1,intercept=0,col='red') +
theme_bw() + theme(panel.grid=element_blank(),plot.title = element_text(hjust=0.5)) +
scale_y_continuous(breaks=seq(0,max(pvalues),by=2)) +
scale_x_continuous(breaks=seq(0,max(exp.x),by=2)) +
labs(x = expression(Expected ~ ~-log[10](italic(p))), y = expression(Observed ~ ~-log[10](italic(p)))) +
ggtitle('Lymphocytes in sigmoid colon samples');# g
dim(df)
g
#
EXPR.df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/expression_data.txt',data.table = F,stringsAsFactors = F)
library(data.table)
#
EXPR.df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/expression_data.txt',data.table = F,stringsAsFactors = F)
f <- '/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/gtex_all.filter.name.top3.txt'
df.pheno <- fread(f,stringsAsFactors = F,data.table = F)
df.infil <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
head(EXPR.df)
CELL <- list('T cells follicular helper','Lymph_Sum','MastSum')
tis <- list('Thyroid','Colon - Sigmoid','Esophagus - Muscularis')
GENE <- list('COMMD3','C22orf43','CCDC40');
phenoName <- list("Tfh cells (transformed)",
"Lymphocytes (transformed)",
"Mast cells (transformed)")
pheno <- as.list(paste0('pheno',id,'.2'))
id
g.expr1 <- list(); g.expr2 <- list(); res <- list()
head(df.infil)
tis <- 'Thyroid'
CELL <- 'T cells follicular helper'
# use original immune deconvolution data:
X <- subset(df.infil,SMTSD==tis)
df.pheno.sub <- X[,c('ID',CELL[[i]])]; colnames(df.pheno.sub) <- c('IID',pheno[[i]])
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE[[i]])],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
full_id <- X[,'Input Sample']
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE[[i]])],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
tis <- 'Thyroid'
CELL <- 'T cells follicular helper'
pheno <- "Tfh cells (transformed)"
GENE <- 'DNAJC1'
# use original immune deconvolution data:
X <- subset(df.infil,SMTSD==tis)
df.pheno.sub <- X[,c('ID',CELL)]; colnames(df.pheno.sub) <- c('IID',pheno[[i]])
full_id <- X[,'Input Sample']
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE)],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
head(df.pheno.sub)
pheno
# use original immune deconvolution data:
X <- subset(df.infil,SMTSD==tis)
df.pheno.sub <- X[,c('ID',CELL)]; colnames(df.pheno.sub) <- c('IID',pheno[[i]])
df.pheno.sub <- X[,c('ID',CELL)]; colnames(df.pheno.sub) <- c('IID',pheno)
full_id <- X[,'Input Sample']
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE)],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
# plot:
df.mg$EXPR_BIN <- quantcut(df.mg[,GENE[[i]]],3)
library(data.table)
library(ggplot2)
library(GenABEL)
library(cowplot)
library(gtools)
EXPR.df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/expression_data.txt',data.table = F,stringsAsFactors = F)
f <- '/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/gtex_all.filter.name.top3.txt'
df.pheno <- fread(f,stringsAsFactors = F,data.table = F)
df.infil <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
tis <- 'Thyroid'
CELL <- 'T cells follicular helper'
pheno <- "Tfh cells (transformed)"
GENE <- 'DNAJC1'
# use original immune deconvolution data:
X <- subset(df.infil,SMTSD==tis)
df.pheno.sub <- X[,c('ID',CELL)]; colnames(df.pheno.sub) <- c('IID',pheno)
full_id <- X[,'Input Sample']
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE)],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
# plot:
df.mg$EXPR_BIN <- quantcut(df.mg[,GENE[[i]]],3)
# plot:
df.mg$EXPR_BIN <- quantcut(df.mg[,GENE,3)
# plot:
df.mg$EXPR_BIN <- quantcut(df.mg[,GENE],3)
df.mg$PHENOTYPE <- df.mg[,pheno]
geneName <- GENE[[i]]
geneName <- GENE
cor.test(df.mg[,GENE[[i]]],rntransform(df.mg$PHENOTYPE))
cor.test(df.mg[,GENE],rntransform(df.mg$PHENOTYPE))
library(data.table)
library(ggplot2)
library(GenABEL)
library(cowplot)
library(gtools)
EXPR.df <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/expression_data.txt',data.table = F,stringsAsFactors = F)
f <- '/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/GeneticAnalysis/gtex_all.filter.name.top3.txt'
df.pheno <- fread(f,stringsAsFactors = F,data.table = F)
df.infil <- fread('/Users/andrewmarderstein/Documents/Research/GTEx/Infiltration/GTEx_infil/output/infiltration_profiles/GTEx_v7_genexpr_ALL.CIBERSORT.ABS-T.QN-F.perm-1000.txt',data.table = F,stringsAsFactors = F)
tis <- 'Thyroid'
CELL <- 'T cells follicular helper'
pheno <- "Tfh cells (transformed)"
GENE <- 'DNAJC1'
# use original immune deconvolution data:
X <- subset(df.infil,SMTSD==tis)
df.pheno.sub <- X[,c('ID',CELL)]; colnames(df.pheno.sub) <- c('IID',pheno)
full_id <- X[,'Input Sample']
EXPR.df.sub <- subset(EXPR.df,SAMP %in% full_id)
df.mg <- merge(EXPR.df.sub[,c('SAMP2',GENE)],df.pheno.sub[,c('IID',pheno)],by.x='SAMP2',by.y='IID')
# plot:
df.mg$EXPR_BIN <- quantcut(df.mg[,GENE],3)
df.mg$PHENOTYPE <- df.mg[,pheno]
geneName <- GENE
cor.test(df.mg[,GENE],rntransform(df.mg$PHENOTYPE))
(0.02371303-0.20692714)/2
